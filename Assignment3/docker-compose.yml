# ğŸŒŸ æ³¨æ„ï¼šå·²ç§»é™¤ version å­—æ®µä»¥é¿å…è­¦å‘Š
services:
  # --- åº”ç”¨æœåŠ¡ (FastAPI) ---
  auth_app:
    # ğŸŒŸ æŒ‡å‘æ–°çš„ Dockerfile åç§°
    build:
      context: .
      dockerfile: Dockerfile.final
      
    container_name: assignment4-auth-app
    
    # ğŸŒŸ ç¡®ä¿ä¾èµ–å…³ç³»
    depends_on:
      - db
      - redis
      
    # ç«¯å£æ˜ å°„
    ports:
      - "8000:8000"
      
    restart: always
    
    # ğŸŒŸ åº”ç”¨ç¨‹åºè¿æ¥ DB/Redis çš„ç¯å¢ƒå˜é‡
    environment:
      DB_HOST: db
      DB_NAME: auth_db
      DB_USER: auth_user
      DB_PASSWORD: auth_password
      REDIS_HOST: redis
      REDIS_PORT: 6379
      # å¦‚æœæ‚¨çš„åº”ç”¨è¿˜éœ€è¦å…¶ä»–ç¯å¢ƒå˜é‡ï¼Œè¯·åœ¨æ­¤å¤„æ·»åŠ 
      
    # æŒ‚è½½å·ï¼šå»ºè®®åœ¨å¼€å‘æ—¶å¼€å¯ï¼Œæ–¹ä¾¿çƒ­é‡è½½
    # volumes:
    #   - .:/app

  # --- æ•°æ®åº“æœåŠ¡ (PostgreSQL) ---
  db:
    image: postgres:16-alpine
    container_name: assignment4-db
    restart: always
    
    # ğŸŒŸ å…³é”®ï¼šé…ç½®æ•°æ®åº“å’Œè§’è‰²ï¼Œè§£å†³ FATAL é”™è¯¯
    environment:
      POSTGRES_DB: auth_db
      POSTGRES_USER: auth_user
      POSTGRES_PASSWORD: auth_password
      
    # æ•°æ®å·ï¼šæŒä¹…åŒ–æ•°æ®åº“æ•°æ®
    volumes:
      - pgdata:/var/lib/postgresql/data
      
  # --- ç¼“å­˜æœåŠ¡ (Redis) ---
  redis:
    image: redis:7-alpine
    container_name: assignment4-redis
    restart: always
    
    # æ•°æ®å· (å¦‚æœéœ€è¦æŒä¹…åŒ– Redis æ•°æ®)
    volumes:
      - redisdata:/data

# --- å®šä¹‰æ•°æ®å· ---
volumes:
  pgdata:
  redisdata: